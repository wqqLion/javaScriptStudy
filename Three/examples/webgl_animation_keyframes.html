<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>关键帧动画</title>
    <link rel="stylesheet" href="main.css">
    <style>
        body{
            background: #bfe3dd;
            color: #000;
        }
        a{
            color: #2983ff;
        }
    </style>
</head>
<body>
<div id="container"></div>
<div id="info">
    <a href="http://threejs.org" target="_blank" rel="noopener">three.js</a> webgl - animation - keyframes<br/>
    Model: <a href="https://www.artstation.com/artwork/1AGwX" target="_blank" rel="noopener">Littlest Tokyo</a> by
    <a href="https://www.artstation.com/glenatron" target="_blank" rel="noopener">Glen Fox</a>, CC Attribution.
</div>
</body>


<script type="module">
    import * as THREE from '../build/three.module.js';
    import Stats from './jsm/libs/stats.module.js';
    import {OrbitControls} from "./jsm/controls/OrbitControls.js";
    import {GLTFLoader} from "./jsm/loaders/GLTFLoader.js";
    import {DRACOLoader} from "./jsm/loaders/DRACOLoader.js";

    var scene,camera,pointLight,stats;
    var renderer,mixer,controls;

    var clock = new THREE.Clock();
    var container = document.getElementById('container');

    stats = new Stats();
    container.appendChild(stats.dom);

    // 渲染器
    renderer = new THREE.WebGLRenderer({antialias:true})//开启抗锯齿
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth,window.innerHeight);
    renderer.gammaOutput = true;//如果设置了，那么它期望所有的纹理和颜色都需要以预乘的形式输出。默认false。
    renderer.gammaFactor = 2.2;
    container.appendChild(renderer.domElement);
    // 场景
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0xbfe3dd);
    // 相加
    camera = new THREE.PerspectiveCamera(40,window.innerWidth/window.innerHeight,1,100);
    camera.position.set(5,2,8);
    // 控制器
    controls = new OrbitControls(camera,renderer.domElement);
    controls.target.set(0,0.5,0);
    controls.enablePan = false;
    // 增加场景光
    scene.add(new THREE.AmbientLight(0x404040));

    pointLight = new THREE.PointLight(0xffffff);
    pointLight.position.copy(camera.position);
    scene.add(pointLight);

    var path = 'textures/cube/Park2/';
    var format = '.jpg';
    var envMap = new THREE.CubeTextureLoader().load( [
        path + 'posx' + format, path + 'negx' + format,
        path + 'posy' + format, path + 'negy' + format,
        path + 'posz' + format, path + 'negz' + format
    ] );
    DRACOLoader.setDecoderPath('js/libs/draco/gltf/');

    var loader = new GLTFLoader();
    loader.setDRACOLoader(new DRACOLoader());
    loader.load( 'models/gltf/LittlestTokyo.glb', function ( gltf ) {
        var model = gltf.scene;
        model.position.set( 1, 1, 0 );
        model.scale.set( 0.01, 0.01, 0.01 );
        model.traverse( function ( child ) {
            if ( child.isMesh ) child.material.envMap = envMap;
        } );
        scene.add( model );
        mixer = new THREE.AnimationMixer( model );
        mixer.clipAction( gltf.animations[ 0 ] ).play();
        animate();
    }, undefined, function ( e ) {
        console.error( e );
    } );
    window.onresize = function () {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( window.innerWidth, window.innerHeight );
    };
    function animate() {
        requestAnimationFrame( animate );
        var delta = clock.getDelta();
        mixer.update( delta );
        controls.update( delta );
        stats.update();
        renderer.render( scene, camera );
    }





</script>
</html>