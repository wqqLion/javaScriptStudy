<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        #stats{
            position: absolute;
            left: 0;
            top: 0;
        }
        .dg{
            position: absolute;
            right: 0;
            top: 0;
        }
    </style>
</head>
<body>

</body>
<script src="../js/three108.js"></script>
<script src="../js/Stats.js"></script>
<script src="../js/dat.gui.min.js"></script>
<script>
    var renderer,camera,scene,gui,stats,ambientLight,pointLight;
    var debug,sphere,cube,plane;

    function initRender() {
        renderer = new THREE.WebGLRenderer({antialias:true});
        renderer.setSize(window.innerWidth,window.innerHeight);

        //开启阴影效果
        renderer.shadowMap.enabled = true;
        // 默认的是，没有设置的这个清晰 THREE.PCFShadowMap
        renderer.shadowMap.type = THREE.PCFShadowMap;
        document.body.appendChild(renderer.domElement);
    }

    function initCamera() {
        camera = new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,0.1,1000);
        camera.position.set(0,100,200);
        camera.lookAt(new THREE.Vector3(0,0,0));
    }
    function initScene() {
        scene = new THREE.Scene();
    }

    function initGui() {
        gui = {
            ambientLight:'#111111',//环境光
            pointLight:'#ffffff',//点光源
            intensity:1,//灯光强度
            visible:true,//是否可见
            castShadow:true,//是否开启阴影
            debug:true,//开启光照辅助
            x:40,
            y:60,
            z:10
        }

        var datGui = new dat.GUI();
        datGui.addColor(gui,'ambientLight').name('环境光颜色').onChange(function (e) {
          ambientLight.color.set(e);
        });
        datGui.addColor(gui, "pointLight").name("点光源颜色").onChange(function (e) {
            pointLight.color.set(e);
        });
        datGui.add(gui, "intensity", 0, 5).name("光线强度").onChange(function (e) {
            pointLight.intensity = e;
        });
        datGui.add(gui, "visible").name("显示光").onChange(function (e) {
            pointLight.visible = e;
        });
        datGui.add(gui, "castShadow").name("显示阴影").onChange(function (e) {
            pointLight.castShadow = e;
        });
        datGui.add(gui, "debug").name("开启光照辅助").onChange(function (e) {
            debug.visible = e;
        });

        datGui.add(gui, "x", -50, 50).name("X坐标位置").onChange(changePosition);
        datGui.add(gui, "y", 0, 200).name("Y坐标位置").onChange(changePosition);
        datGui.add(gui, "z", -50, 50).name("Z坐标位置").onChange(changePosition);
        //修改球体位置的方法，平行光的target就是球
        function changePosition() {
            pointLight.position.set(gui.x, gui.y, gui.z);
        }
    }

    function initLight() {
        ambientLight = new THREE.AmbientLight("#111111");
        scene.add(ambientLight);

        pointLight = new THREE.PointLight('#ffffff');
        pointLight.position.set(40,60,10);
        // 开启阴影投射
        pointLight.castShadow = true;
        scene.add(pointLight);
        //辅助灯光
        debug = new THREE.PointLightHelper(pointLight);
        debug.name = 'debug';
        scene.add(debug);
    }

    function initModel() {
        //球体
        var sphereGeometry = new THREE.SphereGeometry(5,24,16);
        var sphereMaterial = new THREE.MeshPhongMaterial({color:0xff00ff});

        sphere = new THREE.Mesh(sphereGeometry,sphereMaterial);
        sphere.castShadow = true;
        scene.add(sphere);

        //立方体
        var cubeGeometry = new THREE.CubeGeometry(10,10,10);
        var cubeMaterial = new THREE.MeshLambertMaterial({color:0x00ffff});

        cube = new THREE.Mesh(cubeGeometry,cubeMaterial);
        cube.position.x = 30;
        cube.position.z = -5;

        cube.castShadow = true;
        scene.add(cube);
        //底部平面
        var planeGeometry = new THREE.PlaneGeometry(100,100);
        var planeMaterial = new THREE.MeshLambertMaterial({color:0xaaaaaa});

        plane = new THREE.Mesh(planeGeometry,planeMaterial);
        plane.rotation.x = -0.5*Math.PI;
        plane.position.y = -5;
        //可接收阴影
        plane.receiveShadow = true;
        scene.add(plane);
    }

    function initStats() {
        stats = new Stats();
        document.body.appendChild(stats.domElement);
    }
    function render() {
        renderer.render(scene,camera);
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth,window.innerHeight);
    }

    function animate() {
        render();

        stats.update();

        if(debug){
            debug.update();
        }
        requestAnimationFrame(animate);
    }
    function draw() {
        initGui();
        initStats();
        initRender();
        initScene()
        initCamera();
        initLight();
        initModel();


        animate();
        window.onresize = onWindowResize;
    }
    window.onload = function(){
        draw()
    }
</script>
</html>