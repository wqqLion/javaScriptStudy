<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		<div id="parent">
			<div id="edit"></div>
		</div>
		
	</body>
	<script type="text/javascript">
		function EditInPlaceField(id,parent,value){
			this.id=id;
			this.value = value || 'default value';
			this.parentElement = parent;
			
			this.createElements(this.id);
			this.attachEvents();
		}
		EditInPlaceField.prototype = {
			createElements:function(id){
				this.containerElement = document.createElement('div');
				this.parentElement.appendChild(this.containerElement);
				
				this.staticElement = document.createElement('span');
				this.staticElement.innerHTML = this.value;
				this.containerElement.appendChild(this.staticElement);
				
				this.fieldElement = document.createElement('input');
				this.fieldElement.type = 'text';
				this.fieldElement.value = this.value;
				this.containerElement.appendChild(this.fieldElement);
				
				this.saveButton = document.createElement('input');
				this.saveButton.type = 'button';
				this.saveButton.value = 'Save';
				this.containerElement.appendChild(this.saveButton);
				
				this.cancelButton = document.createElement('input');
				this.cancelButton.type = 'button';
				this.cancelButton.value = 'Cancel';
				this.containerElement.appendChild(this.cancelButton);
				
				this.converToText();
				
			},
			attachEvents:function(){
				var that = this;
				if(window.attachEvent){
					this.staticElement.attachEvent('onclick',function(){that.converToEditable()});
					this.saveButton.attachEvent('onclick',function(){that.save()});
					this.cancelButton.attachEvent('onclick',function(){that.cancel()});
				}else{
					this.staticElement.addEventListener('click',function(){that.converToEditable()});
					this.saveButton.addEventListener('click',function(){that.save()});
					this.cancelButton.addEventListener('click',function(){that.cancel()});
				}
			},
			converToEditable:function(){
				this.staticElement.style.display='none';
				this.fieldElement.style.display = 'inline';
				this.saveButton.style.display = 'inline';
				this.cancelButton.style.display = 'inline';
				this.setValue(this.value);
			},
			save:function(){
				this.value = this.getValue();
				var that = this;
				var callback = {
					success:function(){
						that.converToText();
					},
					failure:function(){
						alert('Eoore saving value');
					}
				}
				//ajax 请求 根据结果执行  success 或者 failure
				//demo 默认成功
				that.converToText();
				// ajaxRequest()
			},
			cancel:function(){
				this.converToText();
			},
			converToText:function(){
				this.staticElement.style.display='inline';
				this.fieldElement.style.display = 'none';
				this.saveButton.style.display = 'none';
				this.cancelButton.style.display = 'none';
				this.setValue(this.value);
			},
			setValue:function(value){
				this.fieldElement.value = value;
				this.staticElement.innerHTML = value;
			},
			getValue:function(){
				return this.fieldElement.value;
			}
		}
		function extend(child,parent){
			var F = function(){};
			F.prototype = parent.prototype;
			child.prototype = new F();
			child.prototype.constructor = child;
			child.parent = parent.prototype;
			if(parent.prototype.constructor == Object.prototype.constructor){
				parent.prototype.constructor = parent;
			}
		}
		//textarea 继承上述类
		function EditInPlaceArea(id,parent,value){
			EditInPlaceArea.parent.constructor.call(this,id,parent,value);
		}
		extend(EditInPlaceArea,EditInPlaceField);
		//重写
		EditInPlaceArea.prototype.createElements = function(){
			this.containerElement = document.createElement('div');
			this.parentElement.appendChild(this.containerElement);
			
			this.staticElement = document.createElement('p');
			this.staticElement.innerHTML = this.value;
			this.containerElement.appendChild(this.staticElement);
			
			this.fieldElement = document.createElement('textarea');
			this.fieldElement.value = this.value;
			this.containerElement.appendChild(this.fieldElement);
			
			this.saveButton = document.createElement('input');
			this.saveButton.type = 'button';
			this.saveButton.value = 'Save';
			this.containerElement.appendChild(this.saveButton);
			
			this.cancelButton = document.createElement('input');
			this.cancelButton.type = 'button';
			this.cancelButton.value = 'Cancel';
			this.containerElement.appendChild(this.cancelButton);
			
			this.converToText();
		}
		var parent = document.getElementById('parent');
		var titleClassical = new EditInPlaceArea('edit',parent,'click here');
		
	</script>
</html>
