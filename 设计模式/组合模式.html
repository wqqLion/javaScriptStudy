<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		<div id="form-box"></div>
	</body>
	<script src="interface.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		var Composite = new Interface('Composite',['add','remove','getChild']);
		var FormItem = new Interface('FormItem',['save','restore']);
		
		
		//组合对象类
		var CompositeForm = function(container,id,method,action){
			this.formComponents = [];
			this.element = document.createElement('form');
			this.element.id = id;
			this.element.method = method || 'post';
			this.element.action = action || '#';
			container.appendChild(this.element);
		}
		CompositeForm.prototype.add = function(child){
			Interface.ensureImplements(child,Composite,FormItem);
			this.formComponents.push(child);
			this.element.appendChild(child.getElement());
		};
		CompositeForm.prototype.remove = function(child){
			for(var i=0; i < this.formComponents.length; i++){
				if(this.formComponents[i] == child){
					this.formComponents.splice(i,1);
					break;
				}
			}
		};
		CompositeForm.prototype.getChild = function(i){
			return this.formComponents[i]
		};
		CompositeForm.prototype.save = function(){
			for(var i=0;i<this.formComponents.length;i++){
				this.formComponents[i].save();
			}
		};
		CompositeForm.prototype.getElement = function(){
			return this.element;
		}
		CompositeForm.prototype.restore = function(){
			for(var i = 0;i<this.formComponents.length;i++){
				this.formComponents[i].restore();
			}
		}
		//叶类对象
		var Field = function(id){
			this.id = id;
			this.element;
		}
		Field.prototype.add = function(){};
		Field.prototype.remove = function(){};
		Field.prototype.getChild = function(){};
		Field.prototype.save = function(){
			setCookie(this.id,this.getValue());
		};
		Field.prototype.getElement = function(){
			return this.element;
		};
		Field.prototype.getValue = function(){
			throw new Error('Unsupported operation on the class Field');
		};
		Field.prototype.restore = function () {
			this.element.value = getCookie(this.id);
		}
		//input  类
		var InputField = function(id,label){
			Field.call(this,id);
			this.input = document.createElement('input');
			this.input.id = id;
			
			this.label = document.createElement('label');
			var labelTextNode = document.createTextNode(label);
			this.label.appendChild(labelTextNode);
			
			this.element= document.createElement('div');
			this.element.className = 'input-field';
			this.element.appendChild(this.label);
			this.element.appendChild(this.input);
		}
		extend(InputField,Field);
		InputField.prototype.getValue = function(){
			return this.input.value;
		}
		//textare 类
		var TextareaField = function(id,label){
			Field.call(this,id);
			this.textarea = document.createElement('textarea');
			this.textarea.id = id;
			
			this.label = document.createElement('label');
			var labelTextNode = document.createTextNode(label);
			this.label.appendChild(labelTextNode);
			
			this.element= document.createElement('div');
			this.element.className = 'textarea-field';
			this.element.appendChild(this.label);
			this.element.appendChild(this.textarea);
		}
		extend(TextareaField,Field);
		TextareaField.prototype.getValue = function(){
			return this.textarea.value;
		}
		var container = document.getElementById('form-box');
		var contactForm = new CompositeForm(container,'contact-form','post','contact.php');
		contactForm.add(new InputField('name','姓名'));
		contactForm.add(new InputField('address','地址'));
	</script>
</html>
